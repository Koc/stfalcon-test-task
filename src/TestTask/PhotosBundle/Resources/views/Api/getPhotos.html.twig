<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
    {% block head %}
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Test Task Api Sandbox</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/foundation/6.1.2/foundation.css">
        {#<link href='http://cdnjs.cloudflare.com/ajax/libs/foundicons/3.0.0/foundation-icons.css' rel='stylesheet'#}
        {#type='text/css'>#}

        <style type="text/css" media="screen">
            #response {
                /*position: absolute;*/
                /*top: 0;*/
                /*right: 0;*/
                /*bottom: 0;*/
                /*left: 0;*/
                width: 100%;
                height: 400px;
            }
        </style>
    {% endblock %}

</head>
<body ng-app="Api.Sandbox">
{% block body %}


    {#<div class="top-bar">#}
    {#<div class="top-bar-left">#}
    {#<ul class="menu">#}
    {#<li class="menu-text">Blog</li>#}
    {#<li><a href="#">One</a></li>#}
    {#<li><a href="#">Two</a></li>#}
    {#<li><a href="#">Three</a></li>#}
    {#</ul>#}
    {#</div>#}
    {#</div>#}

    {#<div class="callout large primary">#}
    {#<div class="row column text-center">#}
    {#<h1>Our Blog</h1>#}
    {#<h2 class="subheader">Such a Simple Blog Layout</h2>#}
    {#</div>#}
    {#</div>#}

    <div class="row medium-8 large-7 columns">
        <div ng-controller="Api.Sandbox.SandboxController as sandboxController">
            <table>
                <thead>
                <tr>
                    <th width="200px">Параметр</th>
                    <th width="400px">Значение</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td>
                        Страница:
                    </td>
                    <td>
                        <input type="text" ng-model="request.page" />
                    </td>
                </tr>
                <tr>
                    <td>
                        Теги:
                    </td>
                    <td>
                        <input type="text" ng-model="request.tags" ng-list="," />
                        <p class="help-text">Можно вводить несколько тегов через запятую.</p>
                    </td>
                </tr>

                <tr>
                    <td colspan="2">
                        <input type="button" ng-click="sandboxController.sendRequest()"
                               ng-class="{'secondary' : requestSubmitting, 'success': !requestSubmitting}"
                               ng-disabled="requestSubmitting"
                               value="send" class="button" />
                    </td>
                </tr>

                <tr>
                    <td colspan="2">
                        <div id="response"></div>
                    </td>

                </tr>

                </tbody>
            </table>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/foundation/6.1.2/foundation.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.3/ace.js" type="text/javascript"
            charset="utf-8"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.9/angular.js"></script>

    <script>
        $(document).foundation();

        var editor = ace.edit('response');
        editor.setTheme('ace/theme/twilight');
        editor.getSession().setMode('ace/mode/json');

        angular.module('Api.Sandbox', [])
                .controller('Api.Sandbox.SandboxController', ['$scope', '$http', function ($scope, $http) {
                    $scope.requestSubmitting = false;

                    this.sendRequest = function () {
                        var url = document.location.href;

                        $scope.requestSubmitting = true;

                        var requestConfig = {
                            method: 'GET',
                            url: url,
                            params: {}
//                            transformResponse: undefined
                        };

                        if ($scope.request) {
                            angular.forEach($scope.request, function (value, key) {
                                if (angular.isArray(value)) {
                                    key += '[]';
                                }
                                requestConfig.params[key] = value;
                            });
                        }

                        $http(requestConfig)
                                .then(function successCallback(response) {
//                                    console.log(response);
                                    editor.setValue(JSON.stringify(response.data, null, 4), -1);
                                    $scope.requestSubmitting = false;
                                }, function errorCallback(response) {
                                    $scope.requestSubmitting = false;
                                });

                    }
                }]);
    </script>
{% endblock body %}
</body>
</html>
